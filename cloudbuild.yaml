

steps:

  - id: api
    name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'eu.gcr.io/pmoncada-001/istio-poc/api:$COMMIT_SHA', 'api/', '-f', 'api/Dockerfile']
    waitFor: ['-']

  - id: audit
    name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'eu.gcr.io/pmoncada-001/istio-poc/audit:$COMMIT_SHA', 'audit/', '-f', 'audit/Dockerfile']
    waitFor: ['-']

  - id: coverage
    name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'eu.gcr.io/pmoncada-001/istio-poc/coverage:$COMMIT_SHA', 'coverage/', '-f', 'coverage/Dockerfile']
    waitFor: ['-']

  - id: iam
    name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'eu.gcr.io/pmoncada-001/istio-poc/iam:$COMMIT_SHA', 'iam/', '-f', 'iam/Dockerfile']
    waitFor: ['-']

  - id: mailer
    name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'eu.gcr.io/pmoncada-001/istio-poc/mailer:$COMMIT_SHA', 'mailer/', '-f', 'mailer/Dockerfile']
    waitFor: ['-']

images:
  - eu.gcr.io/pmoncada-001/istio-poc/api:$COMMIT_SHA
  - eu.gcr.io/pmoncada-001/istio-poc/audit:$COMMIT_SHA
  - eu.gcr.io/pmoncada-001/istio-poc/coverage:$COMMIT_SHA
  - eu.gcr.io/pmoncada-001/istio-poc/iam:$COMMIT_SHA
  - eu.gcr.io/pmoncada-001/istio-poc/mailer:$COMMIT_SHA